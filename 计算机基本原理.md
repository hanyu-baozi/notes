## 第一章  计算机系统概述

**本章主要对计算机系统作了概述性的说明，指出了“计算机组成原理”课程的内容在整个计算机系统中的位置。**主要内容包括：

**(1)计算机系统的组成：**分软件和硬件两部分。硬件和软件的界面是指令系统。

(2)计算机系统的层次结构：

①从机器使用者的角度来说，粗分为应用软件、系统软件和硬件三个层次。

②从程序设计员和机器硬件设计者的角度来说，细分为：高级语言虚拟机、汇编语言虚拟机、操作系统虚拟机、机器语言机器、微程序机器。

(3)硬件和软件的相互关系：

①两者相辅相成，缺一不可。

②两者都用来实现逻辑功能，同一功能可用硬件实现，也可用软件实现。

(4)冯诺依曼计算机结构的特点：

①有运算器、控制器、存储器、输入、输出五大部分组成。

②指令和数据用二进制表示，两者形式上没有差别。

③指令和数据存放在存储器中，按地址访问。

④指令由操作码和地址码组成，操作码指定操作性质，地址码指定操作数地址。

⑤采用“存储程序控制”方式进行工作。

(5)计算机硬件的基本组成和功能：

①运算器用来进行各种算术逻辑运算。

②控制器用来执行指令，送出操作控制信号，

③存储器用来存放指令和数据。

④输入和输出设备用来实现计算机和用户之间的信息交换。

(6)计算机的工作过程：

①用某种语言(高级语言或低级语言)编制程序，称为源程序。

②用语言处理程序(编译程序或汇编程序)将源程序翻译成机器语言目标程序。

③启动目标程序，将所含的指令和数据装入内存。

④从第一条指令开始执行：取指令、指令译码、取操作数，运算、送结果、PC指向下一条指令。

⑤重复第④步，周而复始地执行指令，直到程序所含指令全部执行完。

**(7) 性能的定义：一般用程序的响应时间或系统的吞吐率表示性能。**

**(8) 性能的测量：**

① 一般把程序的响应时间划分成CPU时间和等待时间，CPU时间又分成用户CPU时间和系统CPU时间。

② 因为操作系统对自己所花费的时间进行测量时，不十分准确，所以，对CPU性能的测量一般通过测量程序运行的用户CPU时间来进行。

**(9) 各种性能指标之间的关系：**

① CPU执行时间=CPU时钟周期数 x 时钟周期

② 时钟周期和时钟频率互为倒数

③ CPU时钟周期数 = 程序指令数 x 每条指令的平均时钟周期数CPI

**(10) 性能评价程序的选择：**

① 采用一组基准测试程序来对机器的性能进行评测。

② 有些制造商会针对评测程序中频繁出现的语句采用专门的编译器，使评测程序的运行效率大幅提高。因此有时基准评测程序也不能说明问题。

**(11) 对于某种特定的指令集体系结构，提高计算机性能的主要途径有：**

① 提高时钟频率

② 优化处理器中数据通路的结构以降低CPI

③ 采用编译优化措施来减少指令条数或降低指令复杂度

## 第二章 数据机器级表示

本章主要介绍数据的机器级表示。主要包括：真值和机器数的概念，无符号数的表示和作用、定点数的表示、浮点数的表示(包括浮点数的形式、浮点数的规格化、浮点数的表示范围、IEEE754标准)。

　　具体总结如下：

数据信息有两大类：数值数据与非数值数据

**(1) 数值数据：在数轴上有对应的点、能比较大小的数。**

　　①二进制表示

　　i. 无符号数：正整数，用来表示地址等

　　ii. 带符号数：分定点数和浮点数两种

　　a) 定点数：有定点整数和定点小数

　　定点整数：用来表示现实中的整数，一般用补码表示。

　　定点小数：用来表示浮点数中的尾数部分。

　　b) 浮点数：用来表示现实中的实数。用两个定点数来表示浮点数。尾数部分用定点小数表示，阶码部分（指数）用定点整数表示。一般用移码表示阶码。现代计算机统一用IEEE754标准来表示浮点数。

　　② 十进制表示：用二进制对十进制数进行编码，称为BCD码。一般用8421码表示。

**(2) 非数值数据：在数轴上没有对应的点的数据。如：逻辑数、西文字符、汉字等**

## 第三章 运算方法和运算部件设计

本章主要介绍运算算法和运算部件。主要包括：定点数运算（包括移位运算、扩展运算、加减运算、乘法运算、除法运算）、浮点数运算、算术逻辑单元ALU和快速加法器。

具体总结如下：

**（1） 定点数运算：由专门的定点运算器实现**

　　① 移位运算

　　a) 逻辑移位：对无符号数进行，左（右）边补0，低（高）位移出

　　b) 算术移位：对带符号整数进行，移位前后符号位不变，编码不同，方式不同

　　c) 循环移位：最左（右）边位移到最低（高）位，其他位左（右）移一位

　　② 扩展运算

　　a) 零扩展：对无符号整数进行高位补0

　　b) 符号扩展：对补码整数在高位直接补符

　　③ 加减运算

　　a) 补码加/减运算：用于整数加/减运算。符号位和数值位一起运算，减法用加法实现。同号相加时，若结果的符号不同于加数的符号，则会发生溢出。

　　b) 原码加/减运算：用于浮点数尾数加/减运算。符号位和数值位分开运算，同号相加，异号相减，大数减小数，结果取大数的符号。减法用加负数补码实现。

　　④ 乘法运算：用加法和右移实现。

　　a) 补码乘法：用于整数乘法运算。符号位和数值位一起运算。采用Booth算法。

　　b) 原码乘法：用于浮点数尾数乘法运算。符号位和数值位分开运算。数值部分用无符号数乘法实现。

　　⑤ 除法运算：用加/减法和左移实现。

　　a) 补码除法：用于整数除法运算。符号位和数值位一起运算。

　　b) 原码除法：用于浮点数尾数除法运算。符号位和数值位分开运算。数值部分用无符号数除法实现。

**（2） 浮点数运算：由专门的浮点运算器实现**

　　① 加减运算

　　a) 对阶：小阶向大阶看齐，阶小的那个数的尾数右移，直到两数阶码相同，右移时，增加保护位。

　　b) 尾数相加减：用定点数加/减运算实现。

　　 c) 规格化处理：根据结果进行左规或右规操作。

　　d) 舍入：有就近舍入 / 正向舍入 / 负向舍入 / 截去四种方式。

　　e) 溢出判断：当结果发生阶码上溢时，发生溢出。

　　② 乘除运算：尾数用定点数乘/除运算实现，阶码用定点数加/减运算实现。

**（3） 快速加法器（并行加法器、先行进位加法器）**

　　a) 加法器是加/减/乘/除运算的基础，加法器的速度至关重要

　　b) 进位方式是影响加法器速度的重要因素

　　c) 并行进位方式能加快加法器速度

　　d) 通过“进位生成”和“进位传递”函数来使各进位独立、并行产生

**（4） 算术逻辑单元ALU**：在先行进位加法器的基础上增加其他逻辑，实现基本的算术和逻辑运算的部件。有两个操作数输入、低位进位输入、一个操作控制输入、一个结果输出、一位高位进位输出和相等标志输出等

第四章 存储器分层体系结构

本章主要内容包括：存储器的分类、存储器的分层结构、半导体随机存取存储器的组织、只读存储器、主存储器与CPU的连接、多体交叉编址存储器、高速缓冲存储器Cache的基本原理、Cache和主存之间的地址映射、替换算法、虚拟存储器的基本概念、页表结构、缺页异常、转换后援缓冲器TLB等。具体总结如下：

(1)存储器的分类

①按存取方式分：随机、顺序、直接、相联

②按存储介质分：半导体、磁表面、激光盘

③按信息可更改性：可读可写、只读

④按断电后可否保存：易失、非易失

⑤按功能/容量/速度分：寄存器、Cache、主存(内存)、辅存(外存)

(2)存储器的分层结构：速度从快到慢、容量从小到大、价格从贵到便宜，按与CPU连接的距离由近到远的顺序，构成的分层次结构为：
寄存器→Cache→主存→磁盘→光盘、磁带

(3)半导体随机存取存储器的组织
存储元(记忆单元)→存储芯片→存储模块(内存条)→存储器

(4)只读存储器：MROM、PROM、EPROM、EEPROM、Flash ROM

(5)存储器芯片与CPU的连接

a)地址线的连接：考虑芯片在字方向上扩展，低位用于芯片内地址、高位用于片选逻辑，送到片选信号译码器，译码输出连到芯片的片选信号引脚上。

b)数据线的连接：考虑芯片在位方向上扩展，分别连到位扩展的芯片上

c)控制线的连接：读/写信号、主存/IO访问信号等经过组合连到芯片相应的引脚。

(6)主存的主要技术指标
存取时间：执行一次读操作或写操作的时间，分读出时间和写入时间。
存取周期：存储器进行连续两次独立的读或写操作所需的最小时间间隔。
存储器带宽：每秒钟从存储器进/出信息的最大数量。

(7)多体交叉编址存储器

a)连续编址：按高位地址划分模块

b)交叉编址：按低位地址划分模块

(8)Cache的基本原理：利用程序访问的局部性特点，把主存中的一块数据复制到Cache

a)时间局部性：某个单元在一个集中的时间段被重复访问的可能性很大

b)空间局部性：某个单元被访问后，其周围单元不久也将被访问的可能性很大

(9)Cache和主存间的映射

a)直接映射：每个主存块只能存放到一个固定的Cache块(槽)中

b)相联映射：每个主存块可以存放到任何一个Cache块(槽)中

c)组相联映射：Cache分成若干组，每组有多个块(槽)，每个主存块存放到一个固定组的任意块(槽)中

(10)替换算法

a)FIFO：总是把最先调到Cache的那个主存块淘汰掉。

b)LRU：总是把最近最少用到的那个主存块淘汰掉。

(11)写策略

a)写回法：暂时只写入Cache有，直到从Cache中替换出来时，才一次写入主存。

b)写直达法：每次写入Cache时也同时写入主存，一般在Cache和主存之间加一个Witre Buffer。

(12)虚拟存储器的基本原理：程序员在一个独立的极大的虚拟地址空间中写程序，每个程序按照等长的页或变长的段来划分，主存也按等长的页框或段帧来划分，当程序启动运行后，当前用到的程序快(代码或数据)装入到主存的页框或段帧中，其他暂时不用的部分放在磁盘上，通过页表或段表把程序块和主存页框(或段帧)建立对应关系。不在主存的页则在页表中记录其在磁盘上的地址。在指令执行过程中，由特殊的硬件(MMU)和操作系统一起实现存储访问的操作。虚拟存储器的引入，使得程序员写程序时不受主存空间大小的限制；也便于主存空间的利用，因为无需分配连续的页框给连续的虚页；此外，更方便存储保护。

(13)虚拟存储器的实现方案：分页式、分段式、段页式

(14)地址转换：根据逻辑地址中的虚页号，找到对应的页表项。通过页表项得到对应虚页的页框号，再和页内地址相加得到物理地址。

(15)页表和页表项：每个进程有一个页表，每个页表项由有效位、使用位、修改位、存取权限位、主存页框号或磁盘地址等组成。

(16)“缺页”：在执行执行时可能发生缺页，是一种程序性中断。操作系统的缺页处理程序从磁盘读入一个页面到主存，并修改页表。缺页处理完后，要回到原来发生缺页的指令重新执行。

(17)TLB(快表)：是用来存放若干常用页表项的Cache。目的是为了减少到主存访问页表的次数。

(18)存储保护：访问越界和存取方式违例

## 第四章 存储器分层体系结构

**本章主要内容包括：存储器的分类、存储器的分层结构、半导体随机存取存储器的组织、只读存储器、主存储器与CPU的连接、多体交叉编址存储器、高速缓冲存储器Cache的基本原理、Cache和主存之间的地址映射、替换算法、虚拟存储器的基本概念、页表结构、缺页异常、转换后援缓冲器TLB等。**具体总结如下：

(1)存储器的分类

①按存取方式分：随机、顺序、直接、相联

②按存储介质分：半导体、磁表面、激光盘

③按信息可更改性：可读可写、只读

④按断电后可否保存：易失、非易失

⑤按功能/容量/速度分：寄存器、Cache、主存(内存)、辅存(外存)

**(2)存储器的分层结构：**速度从快到慢、容量从小到大、价格从贵到便宜，按与CPU连接的距离由近到远的顺序，构成的分层次结构为：
寄存器→Cache→主存→磁盘→光盘、磁带

**(3)半导体随机存取存储器的组织**
存储元(记忆单元)→存储芯片→存储模块(内存条)→存储器

**(4)只读存储器：**MROM、PROM、EPROM、EEPROM、Flash ROM

(5)存储器芯片与CPU的连接

a)地址线的连接：考虑芯片在字方向上扩展，低位用于芯片内地址、高位用于片选逻辑，送到片选信号译码器，译码输出连到芯片的片选信号引脚上。

b)数据线的连接：考虑芯片在位方向上扩展，分别连到位扩展的芯片上

c)控制线的连接：读/写信号、主存/IO访问信号等经过组合连到芯片相应的引脚。

**(6)主存的主要技术指标**
存取时间：执行一次读操作或写操作的时间，分读出时间和写入时间。
存取周期：存储器进行连续两次独立的读或写操作所需的最小时间间隔。
存储器带宽：每秒钟从存储器进/出信息的最大数量。

(7)多体交叉编址存储器

a)连续编址：按高位地址划分模块

b)交叉编址：按低位地址划分模块

**(8)Cache的基本原理：**利用程序访问的局部性特点，把主存中的一块数据复制到Cache

a)时间局部性：某个单元在一个集中的时间段被重复访问的可能性很大

b)空间局部性：某个单元被访问后，其周围单元不久也将被访问的可能性很大

(9)Cache和主存间的映射

a)直接映射：每个主存块只能存放到一个固定的Cache块(槽)中

b)相联映射：每个主存块可以存放到任何一个Cache块(槽)中

c)组相联映射：Cache分成若干组，每组有多个块(槽)，每个主存块存放到一个固定组的任意块(槽)中

(10)替换算法

a)FIFO：总是把最先调到Cache的那个主存块淘汰掉。

b)LRU：总是把最近最少用到的那个主存块淘汰掉。

(11)写策略

a)写回法：暂时只写入Cache有，直到从Cache中替换出来时，才一次写入主存。

b)写直达法：每次写入Cache时也同时写入主存，一般在Cache和主存之间加一个Witre Buffer。

**(12)虚拟存储器的基本原理：**程序员在一个独立的极大的虚拟地址空间中写程序，每个程序按照等长的页或变长的段来划分，主存也按等长的页框或段帧来划分，当程序启动运行后，当前用到的程序快(代码或数据)装入到主存的页框或段帧中，其他暂时不用的部分放在磁盘上，通过页表或段表把程序块和主存页框(或段帧)建立对应关系。不在主存的页则在页表中记录其在磁盘上的地址。在指令执行过程中，由特殊的硬件(MMU)和操作系统一起实现存储访问的操作。虚拟存储器的引入，使得程序员写程序时不受主存空间大小的限制；也便于主存空间的利用，因为无需分配连续的页框给连续的虚页；此外，更方便存储保护。

**(13)虚拟存储器的实现方案：**分页式、分段式、段页式

**(14)地址转换：**根据逻辑地址中的虚页号，找到对应的页表项。通过页表项得到对应虚页的页框号，再和页内地址相加得到物理地址。

**(15)页表和页表项：**每个进程有一个页表，每个页表项由有效位、使用位、修改位、存取权限位、主存页框号或磁盘地址等组成。

**(16)“缺页”：**在执行执行时可能发生缺页，是一种程序性中断。操作系统的缺页处理程序从磁盘读入一个页面到主存，并修改页表。缺页处理完后，要回到原来发生缺页的指令重新执行。

**(17)TLB(快表)：**是用来存放若干常用页表项的Cache。目的是为了减少到主存访问页表的次数。

**(18)存储保护：**访问越界和存取方式违例



## 第五章 指令系统设计

**本章通过高级语言与汇编代码之间的对应关系，以MIPS处理器的指令系统为例介绍了一个指令系统必须具备的基本功能，并就指令系统设计方面的有关内容进行了介绍。包括：指令的格式、操作数类型、数据在存储器中的存放方式、寻址方式、操作类型、硬件对过程调用的支持、CISC和RISC技术的比较、指令系统举例和分析设计等。**具体总结如下：

(1)指令格式:

a)定长指令字：所有指令长度一致

b)变长指令字：指令长度有长有短

(2)操作类型:

a)数据传送：数据在寄存器、主存单元、栈顶等处进行传送

b)操作运算：各种算术运算、逻辑运算

c)字符串处理：字符串查找、扫描、转换等

d)I/O操作： 与外设接口进行数据/状态/命令信息的交换

e)程序流控制：条件转移、无条件转移、转子、返回等

f)系统控制：启动、停止、自愿访管、空操作等

(3)操作数类型(以Pentium处理器数据类型为例):

a)序数或指针：8位、16位、32位无符号整数表示

b)整数：16位、32位、64位三种补码表示的整数

c)实数：IEEE754浮点数格式

d)十进制数：18位十进制数，用80个二进位表示

e)位串：最长为232-1位

f)字符串：字节为单位的字符序列，一般用ASCII码表示

**(4)操作数宽度：**有多种，如：字节、16位、32位、64位等:

(5)数据存放顺序:

a)大端序：给定的数据所在地址处存放的是数据的最高有效字节(MSB)

b)小端序：给定的数据所在地址处存放的是数据的最低有效字节(LSB)

(6)寻址方式:

a)立即：地址码直接给出操作数本身

b)直接：地址码给出操作数所在的内存单元地址

c)间接：地址码给出操作数所在的内存单元地址所在的内存单元地址

d)寄存器：地址码给出操作数所在的寄存器编号

e)寄存器间接：地址码给出操作数所在单元的地址所在的寄存器编号

f)堆栈：操作数约定在堆栈中，总是从栈顶取数或存数

g)偏移寻址：用基地址+形式地址得到操作数所在的内存单元地址，包括三种：

①变址寻址：地址码给出一个形式地址，并且隐含或明显地指定一个寄存 器作为变址寄存器，变址寄存器的内容(变址值)和形式地址相加，得到操作数的有效地址。

②相对寻址：指令中的形式地址给出一个位移量D，而基准地址由程序计 数器PC提供。即：有效地址EA=(PC)+ D。

③基址寻址：地址码给出一个形式地址，作为位移量，并且隐含或明显地指定一个寄存器作为基址寄存器，基址寄存器的内容和形式地址相加，得到操作数的有效地址。

(7)指令系统风格：决定了处理器的设计:

a)按地址码指定风格来分

①累加器型：一个操作数和结果都隐含在累加器中

②堆栈型：操作数和结果都隐含在堆栈中

③通用寄存器型：操作数明显地指定在哪个通用寄存器中

④装入/存储型：运算类指令的操作数只能在寄存器中，只有装入(Load)指令和存储(Store)指令才能访问内存

b)按指令系统的复杂度来分

①CISC：复杂指令系统计算机

②RISC：精简指令系统计算机

## 第六章 中央处理器设计

**本章以MIPS指令系统中有代表性的几条指令作为实现目标，介绍了单周期数据通路和多周期数据通路的设计过程，以及相应的控制部件的设计。主要内容包括：CPU的主要功能和内部结构、指令的执行过程、数据通路的基本组成、数据通路的定时、数据通路中信息的流动过程、控制器的实现方式、硬连线路控制器的设计、微程序控制器的设计、异常和中断的概念等。**具体总结如下：

(1)CPU的主要功能

a)周而复始执行指令

b)定时查询有没有DMA请求，有DMA请求的话，则让出总线

c)每个指令周期结束，查询有没有中断请求。有中断请求的话，则响应中断

(2)CPU的内部结构：由数据通路(Datapath)和控制单元(Control unit)组成。

a)数据通路中包含组合逻辑单元和存储信息的状态单元。组合逻辑单元用于对数据进行处理，如：加法器、运算器ALU、扩展器(0扩展或符号扩展)、多路选择器、以及状态单元的读操作线路等。状态单元包括触发器、寄存器、寄存器堆、数据/指令存储器等，用于对指令执行的中间状态或最终结果进行保存。

b)控制单元对取出的指令进行译码，与指令执行得到的条件码或当前机器的状态、时序信号等组合，生成对数据通路进行控制的控制信号。

(3)CPU中的寄存器

a)用户可见寄存器

①通用寄存器：可用来存放地址或数据

②数据寄存器：用于保存数据，一般为通用寄存器，需在指令中明显地给出。

③地址寄存器：用于保存地址。可以是通用寄存器，此时，需在指令中明显地给出。也可以是专用寄存器，不需明显给出编号。如：段指针、变址器、基址器、堆栈指针等。

④标志(条件码)寄存器：部分可见。值由CPU硬件根据指令执行的结果设定，只能以隐含方式读出其中的若干位，而不能被程序员(非管理程序)改变。

b)控制和状态寄存器(用户不可使用)

①程序计数器PC

②指令寄存器IR

③存储器地址寄存器MAR

④存储器缓冲(数据)寄存器MBR/MDR

⑤程序状态字寄存器PSWR

⑥其他寄存器：如，进程控制块指针、系统堆栈指针、页表指针等。

**(4)指令执行过程：**取指、译码、取数、运算、存结果、查中断

a)指令周期：取出并执行一条指令的时间，由若干个机器周期组成

b)机器周期：完成一次总线操作访问一次主存或I/O的时间，一个机器周期由多个时钟组成(现代计算机大多数已经没有机器周期的概念，每个指令周期直接由若干个时钟周期组成。)

c)时钟周期：CPU中用于操作控制信号同步的信号。是CPU中最小的时间单位。

**(5)数据通路的定时方式：**现代计算机都采用时钟信号进行定时，规定：一旦时钟有效信号到来，数据通路中的状态单元可以开始写入信息。

**(6)数据通路中信息的流动过程：**每条指令的功能不同，所以，每条指令执行时数据在数据通路中所经过的部件和路径可能不同。但是，每条指令在取指令阶段都一样。

**(7)控制单元的实现方式：**根据不同的控制描述方式，可以有两种不同的实现方式。

a)有限状态图描述：将指令执行过程中每个时钟周期所包含的控制信号值的组合看成一个状态，每来一个时钟，控制信号会有一组新的取值，也就是一个新的状态，这样，所有指令的执行过程就可以用一个有限状态转换图来描述。实现时，用一个组合逻辑电路(一般为PLA电路)来生成控制信号，用一个状态寄存器实现状态之间的转换。所以，也称为组合逻辑电路设计方式，实现的控制器称为硬布线控制器。

b)微程序描述：将指令执行过程中每个时钟周期所包含的控制信号值的组合看成是一个0/1序列，每个控制信号对应一个微命令，控制信号取不同的值，就发出不同的微命令。这样，若干微命令组合成一个微指令，每条指令所包含的动作就由若干条微指令来完成。每条指令执行时，先找到对应的第一条微指令，然后按照特定的顺序取出后续的微指令执行。每来一个时钟，执行一条微指令。实现时，每条指令对应的微指令序列事先存放在一个只读存储器中，用一个PLA电路来控制生成第一条微指令地址，用相应的微程序定序器来控制微指令指令流程。这种方式实现的控制器称为微程序控制器。

**(8)微程序定序器的实现：**有计数器法和下址字段法两种。

(9)中断源的种类：

a)内中断：CPU内部在执行某条指令时发生的异常

①故障：指令执行时异常

②陷阱：自愿访问管理程序

③终止：硬件故障

b)外中断：外设或它机通过中断请求线申请，与执行指令无关

## 第七章 指令流水线设计

本章主要介绍了如何利用流水线来提高指令执行效率。主要内容包括：指令流水线的一般原理、流水线方式下的吞吐率和指令执行时间、流水线的局限性、流水线寄存器的概念、流水线冒险的种类、结构冒险及其处理、控制冒险及其处理、分支预测原理、数据冒险及其处理、转发或旁路技术的原理、流水线数据通路的设计、流水线的控制信号、超标量和动态流水线的概念。具体总结如下：

(1)指令流水线的设计

a)将每条指令的执行规整化为若干个同样的流水阶段

b)每个流水阶段的执行时间一样，都等于一个时钟

c)理想情况下，每个时钟有一条指令进入流水线，也有一条指令执行结束

d)每个流水段中的部件都是组合逻辑加寄存器，组合逻辑中产生的结果在时钟到来时被存储到寄存器(如：程序计数器、条件码寄存器、流水线寄存器等)。每两个相邻流水段之间的流水线寄存器，用以记录所有在后面阶段要用到的各种信息，例如：控制信号、指令的代码、参加运算的操作数、指令运算结果、指令异常信息、寄存器读口地址、寄存器写口地址、存储器地址、新的PC值等。

e)指令译码得到的控制信号通过流水线寄存器传送到后面各个流水段中

(2)指令流水线的局限性

a)并不是每条指令都有相同多个流水段

b)并不是每个流水段都一样长

c)随着流水线深度的增加，流水线寄存器的额外开销比例也增大

d)指令在资源冲突、数据相关或控制相关时会发生流水线冒险

(3)指令流水线的执行效率

a)吞吐率：比非流水线方式下大大提高

b)指令执行时间：相对于非流水线方式，一条指令的执行时间延长了

(4)流水线冒险的种类

a)结构冒险(资源冲突)：多条指令同时使用同一个功能部件

所用解决策略如下：

①规定每个功能部件在一条指令中只能被用一次

②规定每个功能部件只能在某个特定的阶段被用

③指令存储器(Code Cache)和数据存储器(Data Cache)分开

b)数据冒险(数据相关)：前面指令的结果是后面指令的操作数

所用解决策略如下：

①用软件(如：编译器)在后面的数据相关指令前插入nop指令

②硬件上，在后面数据相关指令的特定流水段插入“气泡”以“阻塞”指令继续执行，直到取得所需数据为止

③利用“转发”(旁路)技术把前面指令执行过程中得到的数据直接传送到后面指令用操作数的地方

④对于取数后直接使用的情况(如：Load指令取出的数据是随后的运算指令的操作数)，则采用“阻塞加转发”的方式解决数据冒险

c)控制冒险(控制相关)：返回指令、分支指令等有可能改变顺序增量的PC值，由于获取转移目标地址的时间较长，使得在目标地址产生前已经有指令被取到流水线中，如果已经取出执行的指令不是正确的指令，则发生了控制冒险。

所用解决策略如下：

①用软件(如：编译器)在控制相关指令后面插入nop指令

②硬件上，在控制相关指令后面的指令被取出前插入“气泡”，使流水线停顿若干时钟，直到控制相关指令得到正确的PC值为止。

③采用“分支预测”技术。简单(静态)地预测每次分支结果都一样，或根据分支指令执行历史进行动态预测，动态预测能达到90%的成功率。

④采用延迟分支技术。将前面一条与分支指令无关的指令放到分支指令后面执行，这样，流水线不会发生阻塞现象。这种对指令顺序进行调整的工作在程序编译阶段完成。

**(5)超流水线：**级数更多的流水线

**(6)超标量流水线：**同时发射多条指令的流水线

**(7)动态流水线：**“乱序”执行的流水线

## 第八章 系统总线

本章主要介绍了系统总线的有关概念。包括：总线的基本概念、总线的分类、总线的组成及性能指标、总线结构、总线判优控制、总线通信控制。具体总结如下：

（1）**总线的概念：**总线是为计算机各个部件传送信息的公共通路，包括传输介质和相应的控制逻辑。

（2）**系统总线的概念：**在计算机的主要功能部件（CPU、主存、I/O）之间传送信息的总线，由数据线、地址线和控制线三组线组成。有些总线采用信号线复用的方式，使用同一组线在不同的时间段传送不同的信息。
(注：有些公司（如：Intel）的产品对系统总线赋予了特定的含义)

（3）**系统总线的类型：**处理器-存储器总线、底板总线、I/O总线

（4）**曾经流行或目前常用的总线标准：**ISA、EISA、PCI、SCSI等

（5）**总线结构**

a)单总线结构：所有功能部件（CPU、MM和若干I/O）都挂接在一个总线上

b)二总线结构：CPU、主存、I/O之间分别互连，形成不同的总线。

如：CPU和主存之间用处理器-主存总线，CPU和I/O之间用I/O系统总线；CPU、主存和IOP之间用主存总线，各I/O和IOP之间用I/O总线。

c)多总线结构：将不同速度的部件细分后再分级互连，形成多总线结构。
如：Cache和CPU之间单独用局部总线相连；高速I/O设备和低速I/O设备分离，分别用高速总线和慢速总线相连。

（6）**总线裁决方式**

a)集中裁决：菊花链查询、计时器定时查询、独立请求等

b)分布式裁决：自举方式、冲突检测方式等

（7）**总线定时方式**

a)同步方式：用一个公共的时钟信号进行同步。

b)异步方式：用异步应答控制信号进行定时。

c)半同步方式：结合同步和异步方式的优点，在时钟的同步控制下发出和采样应答信号。

d)分离方式：把通信过程分成两个阶段，使得从设备在准备数据时总线被释放给其他设备使用。

（8）**总线带宽的概念：**指单位时间内总线上可传输的数据量。常用MB/s作为计量单位。它与一次总线事务中传输的数据量、以及总线传输周期的宽度有关，一次总线传输时间越短、数据量越多，则总线带宽越高。

## 第九章 输入输出组织

本章主要介绍了输入输出系统的组成、磁盘存储器的主要技术指标、I/O接口的职能和分类、I/O设备和主机的联系方式、程序查询方式、程序中断方式、DMA方式等内容。具体总结如下：

（1）**I/O系统的组成：**I/O设备及其接口控制逻辑、通道或I/O处理器以及I/O软件等统称为输入/输出系统。

（2）**I/O系统的性能指标：**吞吐率（I/O带宽）和响应时间（时延、等待时间）

（3）**外部设备：**输入设备、输出设备和外存储器统称为外部设备。所有的外部设备通过相应的电缆连到I/O接口电路上，I/O接口电路再连到系统总线，最终与CPU和主存相连。

（4）**磁盘存储器的主要技术指标**

a)记录密度：道密度、位密度

b)平均存取时间：包括磁头寻找目标磁道所需的寻道时间和找到磁道后磁头等待 所需读写的区段旋转到它的下方所需要的旋转等待时间。

c)数据传输率：分为外部数据传输率和内部数据传输率。

（5）**I/O接口的职能：**数据缓冲、记录状态、传递命令、数据格式转换、与主机侧和外设侧分别进行通信。

（6）**I/O接口的类型**

并行/串行、可编程/不可编程、通用/专用、程控/中断/DMA、点对点/多点

（7）**I/O端口：**指I/O接口中的用户可访问寄存器，有数据/命令/状态端口

（8）**I/O指令：**CPU用来控制和访问I/O接口的操作指令

（9）**常用I/O控制方式**

①程序查询方式：CPU通过执行查询程序来完成对外设的控制，实现和外设 的数据传送。在接口未“就绪”或外设“忙”时，CPU处于等待状态。

②程序中断方式：当外设准备好数据或准备好接收新数据或发生了特殊事件时，外设通过向CPU发中断请求，来中止CPU正在执行的程序，转到相应的中断服务程序去执行来完成数据交换或处理特殊事件，结束后，再回到原被中止的程序继续执行。

③DMA方式：DMA方式适合于像磁盘一类的高速设备（外存），以成批方式和主存直接交换数据。首先要对DMA控制器进行初始化；然后由DMA控制器控制总线在主存和高速设备之间进行直接数据交换；最后，DMA控制器发出“DMA传送结束”给外设，由外设发中断请求给CPU，CPU进行DMA结束处理。